(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const $=[{level:1,requiredPoints:0,name:"Beginner"},{level:2,requiredPoints:50,name:"Elementary"},{level:3,requiredPoints:100,name:"Intermediate"},{level:4,requiredPoints:200,name:"Advanced"},{level:5,requiredPoints:300,name:"Fluent"}],N=[{id:"q1",type:"text",question:"What is the Zazaki word for 'hello'?",options:["Merheba","Silav","Rojba≈ü","√áƒ±turi"],correctAnswer:"Merheba",difficulty:1,points:10},{id:"q2",type:"text",question:"How do you say 'thank you' in Zazaki?",options:["Spas","Te≈üekk√ºr","Sƒ±pas","Zaf we≈ü"],correctAnswer:"Zaf we≈ü",difficulty:1,points:10},{id:"q3",type:"text",question:"What is the Zazaki word for 'bread'?",options:["Nan","Go≈üt","Av","Sol"],correctAnswer:"Nan",difficulty:1,points:15},{id:"q4",type:"text",question:"How do you say 'good morning' in Zazaki?",options:["≈ûev xeyr","Roc xeyr","≈ûƒ±ma senin","Xatƒ±r ra"],correctAnswer:"Roc xeyr",difficulty:2,points:20},{id:"q5",type:"text",question:"What is the Zazaki word for 'water'?",options:["Av","Su","Awe","√áay"],correctAnswer:"Awe",difficulty:1,points:10}];async function D(){{console.log("üîç Fetching questions from FaunaDB...");try{const e=await fetch("/.netlify/functions/getQuestions");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log(`‚úÖ Successfully retrieved ${t.length} questions from FaunaDB`),localStorage.setItem("zazakiGameQuestions",JSON.stringify(t)),t}catch(e){console.error("‚ùå Error loading questions from FaunaDB:",e);try{const t=localStorage.getItem("zazakiGameQuestions");if(t){const n=JSON.parse(t);return console.log(`üìã Retrieved ${n.length} questions from localStorage`),n}}catch(t){console.error("‚ùå Error loading questions from localStorage:",t)}return console.log("‚ö†Ô∏è Using default questions"),N}}}function O(){try{const e=localStorage.getItem("zazakiGameLevels");if(e)return JSON.parse(e)}catch(e){console.error("Error loading levels from localStorage:",e)}return $}const l={maxQuestions:10,saveGamePrefix:"zazakiGameSaves",highscorePrefix:"zazakiGameHighscores",maxHighscores:20},C=document.getElementById("welcome-screen"),H=document.getElementById("game-screen"),b=document.getElementById("results-screen"),A=document.getElementById("feedback-modal"),T=document.getElementById("player-name"),z=document.getElementById("start-game"),x=document.getElementById("saved-games-list"),B=document.getElementById("no-saved-games"),I=document.getElementById("highscores-list"),M=document.getElementById("player-name-display"),R=document.getElementById("level-display"),J=document.getElementById("score-display"),W=document.getElementById("question-counter"),Z=document.getElementById("question-text"),h=document.getElementById("image-container"),L=document.getElementById("question-image"),y=document.getElementById("audio-container"),q=document.getElementById("question-audio"),j=document.getElementById("audio-source"),k=document.getElementById("options-container"),U=document.getElementById("save-game"),Y=document.getElementById("quit-game"),X=document.getElementById("final-score"),_=document.getElementById("final-level"),K=document.getElementById("correct-answers"),V=document.getElementById("highscore-entry"),ee=document.getElementById("save-score"),te=document.getElementById("play-again"),oe=document.getElementById("return-home"),G=document.getElementById("feedback-title"),ne=document.getElementById("feedback-message"),re=document.getElementById("next-question");function m(e){C.classList.add("hidden"),H.classList.add("hidden"),b.classList.add("hidden"),e.classList.remove("hidden")}function f(e){M.textContent=`Player: ${e.name}`,R.textContent=`Level: ${e.level}`,J.textContent=`Score: ${e.score}`}function se(e,t){W.textContent=`Question: ${e+1}/${t}`}function ae(e){Z.textContent=e.question,e.type==="image"?(h.classList.remove("hidden"),y.classList.add("hidden"),L.onerror=function(){h.innerHTML='<div class="placeholder-media">Image placeholder: '+e.imageUrl.split("/").pop()+"</div>"},L.src=e.imageUrl):e.type==="audio"?(h.classList.add("hidden"),y.classList.remove("hidden"),j.src=e.audioUrl,q.onerror=function(){y.innerHTML='<div class="placeholder-media">Audio placeholder: '+e.audioUrl.split("/").pop()+"</div>"},q.load()):(h.classList.add("hidden"),y.classList.add("hidden"))}function ce(e,t){k.innerHTML="",e.options.forEach((n,s)=>{const r=document.createElement("div");r.className="option",r.textContent=n,r.dataset.option=n,r.addEventListener("click",()=>t(r,n)),k.appendChild(r)})}function ie(e,t,n){document.querySelectorAll(".option").forEach(r=>{r.classList.remove("selected"),r.style.pointerEvents="none",r.dataset.option===t?r.classList.add("correct"):r.dataset.option===e.dataset.option&&!n&&r.classList.add("incorrect")})}function le(e,t){G.textContent=e?"Correct!":"Incorrect",ne.textContent=e?"Well done! You got it right.":`The correct answer was: ${t}`,G.style.color=e?"var(--correct-color)":"var(--incorrect-color)",A.classList.remove("hidden")}function de(){A.classList.add("hidden")}function ue(e,t){X.textContent=`Your Score: ${e.score}`,_.textContent=`Your Level: ${e.level}`,K.textContent=`Correct Answers: ${e.correctAnswers}/${e.totalQuestions}`,V.style.display=t?"block":"none"}function p(e,t,n){if(x.innerHTML="",e.length===0){B.style.display="block";return}B.style.display="none",e.forEach(s=>{const r=document.createElement("div");r.className="saved-game-item";const a=document.createElement("div");a.textContent=s.displayName;const i=document.createElement("button");i.textContent="Load",i.addEventListener("click",()=>t(s.id));const g=document.createElement("button");g.textContent="Delete",g.style.backgroundColor="var(--incorrect-color)",g.addEventListener("click",()=>n(s.id)),r.appendChild(a),r.appendChild(i),r.appendChild(g),x.appendChild(r)})}function u(e){if(I.innerHTML="",e.length===0){const n=document.createElement("p");n.textContent="No highscores yet. Be the first!",I.appendChild(n);return}e.sort((n,s)=>s.score-n.score),e.slice(0,5).forEach((n,s)=>{const r=document.createElement("div");r.className="highscore-item",r.innerHTML=`
            <span>${s+1}. ${n.name}</span>
            <span>${n.score} points (Level ${n.level})</span>
        `,I.appendChild(r)})}function me(e){let t=document.getElementById("error-message");t||(t=document.createElement("div"),t.id="error-message",t.style.position="fixed",t.style.top="20px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="#f44336",t.style.color="white",t.style.padding="15px 20px",t.style.borderRadius="4px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",t.style.zIndex="1000",document.body.appendChild(t)),t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}const c={welcomeScreen:C,gameScreen:H,resultsScreen:b,playerNameInput:T,startGameButton:z,saveGameButton:U,quitGameButton:Y,saveScoreButton:ee,playAgainButton:te,returnHomeButton:oe,nextQuestionButton:re};function ge(e){try{const n={id:`${e.player.name.replace(/\s+/g,"_")}_${Date.now()}`,player:e.player,currentQuestionIndex:e.currentQuestionIndex,timestamp:Date.now(),displayName:`${e.player.name} (Level ${e.player.level}, Score ${e.player.score})`},s=d();return s.push(n),localStorage.setItem(l.saveGamePrefix,JSON.stringify(s)),!0}catch(t){return console.error("Error saving game:",t),!1}}function d(){try{const e=localStorage.getItem(l.saveGamePrefix);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading saved games:",e),[]}}function he(e){try{return d().find(s=>s.id===e)||null}catch(t){return console.error("Error loading saved game:",t),null}}function ye(e){try{let t=d();return t=t.filter(n=>n.id!==e),localStorage.setItem(l.saveGamePrefix,JSON.stringify(t)),!0}catch(t){return console.error("Error deleting saved game:",t),!1}}async function fe(e){console.log("üîç Saving highscore:",e);try{console.log("üì° Saving to FaunaDB...");const t=await fetch("/.netlify/functions/saveHighscore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log("üìä Response status:",t.status),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();return console.log("‚úÖ Highscore saved successfully:",n),!0}catch(t){return console.error("‚ùå Error saving highscore to FaunaDB:",t),console.log("‚ö†Ô∏è Falling back to localStorage for highscore"),pe(e)}}function pe(e){try{const t=Q();t.push(e),t.sort((s,r)=>r.score-s.score);const n=t.slice(0,l.maxHighscores);return localStorage.setItem(l.highscorePrefix,JSON.stringify(n)),console.log("‚úÖ Highscore saved to localStorage"),!0}catch(t){return console.error("‚ùå Error saving highscore to localStorage:",t),!1}}function Q(){try{const e=localStorage.getItem(l.highscorePrefix);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading highscores from localStorage:",e),[]}}async function v(){console.log("üîç Attempting to fetch highscores...");try{console.log("üîç Attempting to fetch highscores from FaunaDB..."),console.log("üì° Fetching from: /.netlify/functions/getHighscores");const e=await fetch("/.netlify/functions/getHighscores");if(console.log("üìä Response status:",e.status),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log(`‚úÖ Retrieved ${t.length} highscores from FaunaDB`),t}catch(e){console.error("‚ùå Error loading highscores from FaunaDB:",e),console.log("‚ö†Ô∏è Falling back to localStorage for highscores");const t=Q();return console.log(`üìã Retrieved ${t.length} highscores from localStorage`),t}}async function ve(e){try{const t=await v();if(t.length<l.maxHighscores)return!0;const n=t[t.length-1];return e>n.score}catch(t){return console.error("Error checking highscore qualification:",t),!0}}let o={player:{name:"",score:0,level:1,correctAnswers:0},currentQuestionIndex:0,questions:[],levels:[],gameStarted:!1,gameFinished:!1};async function Ee(){try{o.questions=await D(),o.levels=[...O()];try{const t=await v();u(t)}catch(t){console.error("Error loading highscores:",t),u([])}const e=d();p(e,S,w),Se(),console.log("Zazaki Language Learning Game initialized")}catch(e){console.error("Error initializing game:",e),me("Failed to initialize game. Please try refreshing the page.")}}function Se(){c.startGameButton.addEventListener("click",we),c.saveGameButton.addEventListener("click",Le),c.quitGameButton.addEventListener("click",Ce),c.saveScoreButton.addEventListener("click",qe),c.playAgainButton.addEventListener("click",Ge),c.returnHomeButton.addEventListener("click",P),c.nextQuestionButton.addEventListener("click",xe)}function we(){const e=c.playerNameInput.value.trim();if(!e){alert("Please enter your name to start the game.");return}o.player.name=e,o.player.score=0,o.player.level=1,o.player.correctAnswers=0,o.currentQuestionIndex=0,o.gameStarted=!0,o.gameFinished=!1,F(),f(o.player),m(c.gameScreen),E()}function E(){const e=o.questions[o.currentQuestionIndex];se(o.currentQuestionIndex,o.questions.length),ae(e),ce(e,Ie)}function Ie(e,t){const n=o.questions[o.currentQuestionIndex],s=t===n.correctAnswer;ie(e,n.correctAnswer,s),s&&(o.player.score+=n.points,o.player.correctAnswers++,ke()),f(o.player),le(s,n.correctAnswer)}function xe(){de(),o.currentQuestionIndex++,o.currentQuestionIndex>=o.questions.length?Be():E()}async function Be(){o.gameFinished=!0;let e=!0;try{e=await ve(o.player.score)}catch(t){console.error("Error checking highscore qualification:",t),e=!0}ue({score:o.player.score,level:o.player.level,correctAnswers:o.player.correctAnswers,totalQuestions:o.questions.length},e),m(c.resultsScreen)}function Le(){if(!o.gameStarted||o.gameFinished)return;if(ge(o)){alert("Game saved successfully!");const t=d();p(t,S,w)}else alert("Failed to save game. Please try again.")}function S(e){const t=he(e);if(!t){alert("Save data not found!");return}o.player=t.player,o.currentQuestionIndex=t.currentQuestionIndex,o.gameStarted=!0,o.gameFinished=!1,f(o.player),m(c.gameScreen),E()}function w(e){if(ye(e)){const n=d();p(n,S,w)}else alert("Failed to delete saved game. Please try again.")}async function qe(){const e={name:o.player.name,score:o.player.score,level:o.player.level,date:new Date().toISOString()};try{if(await fe(e)){document.getElementById("highscore-entry").style.display="none";const n=await v();u(n),alert("Your score has been saved!")}else alert("Failed to save highscore. Please try again.")}catch(t){console.error("Error saving highscore:",t),alert("Failed to save highscore. Please try again.")}}function ke(){const e=o.levels.find(t=>o.player.score>=t.requiredPoints);e&&e.level>o.player.level&&(o.player.level=e.level)}function F(){for(let e=o.questions.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[o.questions[e],o.questions[t]]=[o.questions[t],o.questions[e]]}}function Ge(){o.player.score=0,o.player.level=1,o.player.correctAnswers=0,o.currentQuestionIndex=0,o.gameFinished=!1,F(),f(o.player),m(c.gameScreen),E()}async function P(){m(c.welcomeScreen);const e=d();p(e,S,w);try{const t=await v();u(t)}catch(t){console.error("Error loading highscores:",t),u([])}}function Ce(){confirm("Are you sure you want to quit? Your progress will be lost unless you save.")&&P()}function He(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(e=>{console.log("ServiceWorker registration failed: ",e)})})}document.addEventListener("DOMContentLoaded",async()=>{await Ee(),He()});
