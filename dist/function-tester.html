<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netlify Function Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 6px;
            margin-bottom: 16px;
            resize: vertical;
        }
        .result {
            background-color: #f1f1f1;
            border-left: 4px solid #2196F3;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .error {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }
        .success {
            background-color: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <h1>Netlify Function Tester</h1>
    <p>This page helps you test your Netlify Functions for the Zazaki Language Learning Game.</p>
    
    <div class="card">
        <h2>Test getHighscores Function</h2>
        <p>This will call the getHighscores function to retrieve highscores from FaunaDB.</p>
        <button id="test-get-highscores">Test getHighscores</button>
        <div id="get-highscores-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="card">
        <h2>Test saveHighscore Function</h2>
        <p>This will call the saveHighscore function to save a test highscore to FaunaDB.</p>
        <div>
            <label for="player-name">Player Name:</label>
            <input type="text" id="player-name" value="Test Player">
        </div>
        <div>
            <label for="player-score">Score:</label>
            <input type="number" id="player-score" value="100">
        </div>
        <div>
            <label for="player-level">Level:</label>
            <input type="number" id="player-level" value="1">
        </div>
        <button id="test-save-highscore">Test saveHighscore</button>
        <div id="save-highscore-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="card">
        <h2>Environment Check</h2>
        <p>This will check if your Netlify Functions are properly deployed.</p>
        <button id="check-environment">Check Environment</button>
        <div id="environment-result" class="result" style="display: none;"></div>
    </div>
    
    <script>
        // Test getHighscores function
        document.getElementById('test-get-highscores').addEventListener('click', async () => {
            const resultElement = document.getElementById('get-highscores-result');
            resultElement.style.display = 'block';
            resultElement.textContent = 'Loading...';
            resultElement.className = 'result';
            
            try {
                const response = await fetch('/.netlify/functions/getHighscores');
                const status = response.status;
                const headers = {};
                for (const [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultElement.textContent = `Error (${status}):\n${errorText}\n\nHeaders:\n${JSON.stringify(headers, null, 2)}`;
                    resultElement.className = 'result error';
                    return;
                }
                
                const data = await response.json();
                resultElement.textContent = `Success (${status}):\n${JSON.stringify(data, null, 2)}\n\nHeaders:\n${JSON.stringify(headers, null, 2)}`;
                resultElement.className = 'result success';
            } catch (error) {
                resultElement.textContent = `Error: ${error.message}`;
                resultElement.className = 'result error';
            }
        });
        
        // Test saveHighscore function
        document.getElementById('test-save-highscore').addEventListener('click', async () => {
            const resultElement = document.getElementById('save-highscore-result');
            resultElement.style.display = 'block';
            resultElement.textContent = 'Loading...';
            resultElement.className = 'result';
            
            const name = document.getElementById('player-name').value;
            const score = parseInt(document.getElementById('player-score').value);
            const level = parseInt(document.getElementById('player-level').value);
            
            if (!name || isNaN(score)) {
                resultElement.textContent = 'Error: Please enter a valid name and score.';
                resultElement.className = 'result error';
                return;
            }
            
            const highscore = {
                name,
                score,
                level: isNaN(level) ? 1 : level,
                date: new Date().toISOString()
            };
            
            try {
                const response = await fetch('/.netlify/functions/saveHighscore', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(highscore)
                });
                
                const status = response.status;
                const headers = {};
                for (const [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultElement.textContent = `Error (${status}):\n${errorText}\n\nHeaders:\n${JSON.stringify(headers, null, 2)}`;
                    resultElement.className = 'result error';
                    return;
                }
                
                const data = await response.json();
                resultElement.textContent = `Success (${status}):\n${JSON.stringify(data, null, 2)}\n\nHeaders:\n${JSON.stringify(headers, null, 2)}`;
                resultElement.className = 'result success';
            } catch (error) {
                resultElement.textContent = `Error: ${error.message}`;
                resultElement.className = 'result error';
            }
        });
        
        // Check environment
        document.getElementById('check-environment').addEventListener('click', async () => {
            const resultElement = document.getElementById('environment-result');
            resultElement.style.display = 'block';
            resultElement.textContent = 'Checking...';
            resultElement.className = 'result';
            
            const results = {
                netlifyFunctions: false,
                getHighscoresExists: false,
                saveHighscoreExists: false,
                corsHeaders: false,
                browserInfo: {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform
                }
            };
            
            // Check if we're on Netlify
            const hostname = window.location.hostname;
            results.isNetlify = hostname.includes('netlify.app') || hostname === 'localhost';
            
            // Check if Netlify Functions are available
            try {
                const response = await fetch('/.netlify/functions');
                results.netlifyFunctionsEndpoint = {
                    status: response.status,
                    ok: response.ok
                };
            } catch (error) {
                results.netlifyFunctionsEndpoint = {
                    error: error.message
                };
            }
            
            // Check if getHighscores function exists
            try {
                const response = await fetch('/.netlify/functions/getHighscores', { method: 'HEAD' });
                results.getHighscoresExists = {
                    status: response.status,
                    ok: response.ok
                };
            } catch (error) {
                results.getHighscoresExists = {
                    error: error.message
                };
            }
            
            // Check if saveHighscore function exists
            try {
                const response = await fetch('/.netlify/functions/saveHighscore', { method: 'OPTIONS' });
                results.saveHighscoreExists = {
                    status: response.status,
                    ok: response.ok
                };
                
                // Check CORS headers
                const corsHeader = response.headers.get('Access-Control-Allow-Origin');
                results.corsHeaders = !!corsHeader;
            } catch (error) {
                results.saveHighscoreExists = {
                    error: error.message
                };
            }
            
            resultElement.textContent = JSON.stringify(results, null, 2);
            
            // Determine overall status
            const success = results.getHighscoresExists.ok && results.saveHighscoreExists.ok;
            resultElement.className = success ? 'result success' : 'result error';
        });
    </script>
</body>
</html>
